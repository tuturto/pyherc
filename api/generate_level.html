

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Generating a level &mdash; Herculeum 0.4 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Herculeum 0.4 documentation" href="index.html" />
    <link rel="next" title="Modular level generator" href="modular_levels.html" />
    <link rel="prev" title="Building blocks" href="module_descriptions.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="modular_levels.html" title="Modular level generator"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="module_descriptions.html" title="Building blocks"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Herculeum 0.4 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="generating-a-level">
<h1>Generating a level<a class="headerlink" href="#generating-a-level" title="Permalink to this headline">¶</a></h1>
<p>This section will have a look at level generation, how different parts of the
software work together to create a new level and how to add new levels into
the game.</p>
<div class="section" id="overview-of-generating-dungeon">
<h2>Overview of generating dungeon<a class="headerlink" href="#overview-of-generating-dungeon" title="Permalink to this headline">¶</a></h2>
<p>Dungeon is used to represent playing area of the game. It contains levels which
player can explore.</p>
<p>Dungeon is generated by <a class="reference internal" href="pyherc/generators/module_dungeon.html#pyherc.generators.dungeon.DungeonGenerator" title="pyherc.generators.dungeon.DungeonGenerator"><tt class="xref py py-class docutils literal"><span class="pre">pyherc.generators.dungeon.DungeonGenerator</span></tt></a>.</p>
</div>
<div class="section" id="adding-a-new-type-of-level">
<h2>Adding a new type of level<a class="headerlink" href="#adding-a-new-type-of-level" title="Permalink to this headline">¶</a></h2>
<p>Adding a new level is quite straightforward procedure, when you know what
you are doing. Following section will give a rough idea how it can be
accomplished.</p>
<div class="section" id="level-generator">
<h3>Level generator<a class="headerlink" href="#level-generator" title="Permalink to this headline">¶</a></h3>
<p>In order to add a new type of level into the game, a level generator needs to
be written first. It has a simple interface:</p>
<div class="highlight-python"><pre>def generate_level(self, portal)</pre>
</div>
<p>Arguments supplied to this function are:</p>
<blockquote>
<div><ul class="simple">
<li>portal - Portal at an existing level, where this level should be connected</li>
</ul>
</div></blockquote>
<div class="section" id="shape-of-the-level">
<h4>Shape of the level<a class="headerlink" href="#shape-of-the-level" title="Permalink to this headline">¶</a></h4>
<p>One of the first things for our level generator to do, is to create a new
Level object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">new_level</span> <span class="o">=</span> <span class="n">Level</span><span class="p">((</span><span class="mi">80</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">tiles</span><span class="o">.</span><span class="n">FLOOR_ROCK</span><span class="p">,</span> <span class="n">tiles</span><span class="o">.</span><span class="n">WALL_GROUND</span><span class="p">)</span>
</pre></div>
</div>
<p>This call will instantiate a Level object, set it size to be 80 times 40,
create floor of rock and fill the whole level will ground wall. After this the
generator can create structure of the level as wanted.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">y_loc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">39</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">x_loc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">79</span><span class="p">):</span>
        <span class="n">new_level</span><span class="o">.</span><span class="n">walls</span><span class="p">[</span><span class="n">x_loc</span><span class="p">][</span><span class="n">y_loc</span><span class="p">]</span> <span class="o">=</span> <span class="n">tiles</span><span class="o">.</span><span class="n">WALL_EMPTY</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-monsters">
<h4>Adding monsters<a class="headerlink" href="#adding-monsters" title="Permalink to this headline">¶</a></h4>
<p>No level is complete without some monsters. Next we will add a single rat:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">monster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">creature_generator</span><span class="o">.</span><span class="n">generate_creature</span><span class="p">(</span>
                                        <span class="n">model</span><span class="o">.</span><span class="n">tables</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span><span class="s">&#39;rat&#39;</span><span class="p">})</span>
<span class="n">new_level</span><span class="o">.</span><span class="n">add_creature</span><span class="p">(</span><span class="n">monster</span><span class="p">,</span> <span class="n">new_level</span><span class="o">.</span><span class="n">find_free_space</span><span class="p">())</span>
</pre></div>
</div>
<p>This will instruct <a class="reference internal" href="pyherc/generators/module_creature.html#pyherc.generators.creature.CreatureGenerator" title="pyherc.generators.creature.CreatureGenerator"><tt class="xref py py-class docutils literal"><span class="pre">pyherc.generators.creature.CreatureGenerator</span></tt></a> to
use supplied monster tables and create a monster called &#8216;rat&#8217;. After this,
the rat is added at a random free location.</p>
</div>
<div class="section" id="adding-items">
<h4>Adding items<a class="headerlink" href="#adding-items" title="Permalink to this headline">¶</a></h4>
<p>Our brave adventurer needs items to loot. Following piece of code will add a
single random food item:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">new_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_generator</span><span class="o">.</span><span class="n">generateItem</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">tables</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">:</span><span class="s">&#39;food&#39;</span><span class="p">})</span>
<span class="n">new_item</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">new_level</span><span class="o">.</span><span class="n">find_free_space</span><span class="p">()</span>
<span class="n">new_level</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_item</span><span class="p">)</span>
</pre></div>
</div>
<p>This will instruct <a class="reference internal" href="pyherc/generators/module_item.html#pyherc.generators.item.ItemGenerator" title="pyherc.generators.item.ItemGenerator"><tt class="xref py py-class docutils literal"><span class="pre">pyherc.generators.item.ItemGenerator</span></tt></a> to use
supplied item tables and create random food type item. After this the item
is added to the level. This portion of the Level interface will most likely
change in the future, to match better to the interface used to add monsters.</p>
</div>
<div class="section" id="linking-to-previous-level">
<h4>Linking to previous level<a class="headerlink" href="#linking-to-previous-level" title="Permalink to this headline">¶</a></h4>
<p>Our level is almost ready, we still need to link it to level above it. This
is done using the Portal object, that was passed to this generator in the
beginning:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">portal</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">new_portal</span> <span class="o">=</span> <span class="n">Portal</span><span class="p">()</span>
    <span class="n">new_portal</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
    <span class="n">new_level</span><span class="o">.</span><span class="n">add_portal</span><span class="p">(</span><span class="n">new_portal</span><span class="p">,</span> <span class="n">new_level</span><span class="o">.</span><span class="n">find_free_space</span><span class="p">(),</span> <span class="n">portal</span><span class="p">)</span>
</pre></div>
</div>
<p>First we create a new Portal and link it to our Model. Then we add it to the
new level at random location and link it to portal on a previous level.</p>
</div>
<div class="section" id="linking-to-further-levels">
<h4>Linking to further levels<a class="headerlink" href="#linking-to-further-levels" title="Permalink to this headline">¶</a></h4>
<p>If you want to this dungeon branch to continue further, you can create new
Portal objects, place them on the level and repeat the process above to
generate level.</p>
<p>Another option is to use proxy level generators, that will cause levels to
be generated at the moment when somebody tries to walk through portal to enter
them.</p>
</div>
<div class="section" id="adding-level-into-the-dungeon">
<h4>Adding level into the dungeon<a class="headerlink" href="#adding-level-into-the-dungeon" title="Permalink to this headline">¶</a></h4>
<p>Now you have a generator that can be used to generate new levels. Last step
is to modify an existing level generator to place a portal and create a level
using this new generator. If that step is skipped, new type of levels will
never get generated.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Generating a level</a><ul>
<li><a class="reference internal" href="#overview-of-generating-dungeon">Overview of generating dungeon</a></li>
<li><a class="reference internal" href="#adding-a-new-type-of-level">Adding a new type of level</a><ul>
<li><a class="reference internal" href="#level-generator">Level generator</a><ul>
<li><a class="reference internal" href="#shape-of-the-level">Shape of the level</a></li>
<li><a class="reference internal" href="#adding-monsters">Adding monsters</a></li>
<li><a class="reference internal" href="#adding-items">Adding items</a></li>
<li><a class="reference internal" href="#linking-to-previous-level">Linking to previous level</a></li>
<li><a class="reference internal" href="#linking-to-further-levels">Linking to further levels</a></li>
<li><a class="reference internal" href="#adding-level-into-the-dungeon">Adding level into the dungeon</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="module_descriptions.html"
                        title="previous chapter">Building blocks</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="modular_levels.html"
                        title="next chapter">Modular level generator</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/generate_level.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="modular_levels.html" title="Modular level generator"
             >next</a> |</li>
        <li class="right" >
          <a href="module_descriptions.html" title="Building blocks"
             >previous</a> |</li>
        <li><a href="index.html">Herculeum 0.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Tuukka Turto.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>